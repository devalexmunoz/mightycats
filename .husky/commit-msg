#!/usr/bin/env sh
set -e # Essential: exit if any command fails

# Attempt to source .env from project root if APP_SERVICE isn't already set
if [ -z "$APP_SERVICE" ] && [ -f "$(dirname "$0")/../.env" ]; then
  set -a; . "$(dirname "$0")/../.env"; set +a
fi

# Exit with an error if APP_SERVICE is still not set
if [ -z "$APP_SERVICE" ]; then
  echo "Error: APP_SERVICE not set. Check environment or project .env file." >&2
  exit 1
fi

# Run commitlint in Docker ($1 is the commit message file)
docker compose exec -T "$APP_SERVICE" npx --no-install -- commitlint --edit "$1"
